<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>TCU | News</title>
		<meta name="description" content="Community project that revives The Crew (2014).">
		<meta name="keywords" content="The Crew, The Crew Unlimited">
		<meta name="author" content="The Crew Unlimited">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" type="image/png" href="/favicon.png">
		<script type="text/javascript" src="/js/tcunet_util.js"></script>
		<script type="text/javascript" src="/js/common_elements.js"></script>
		<script type="text/javascript" src="/js/posts.js"></script>
		<link rel="prefetch" href="/media/tcu.png"/>
		<link rel="prefetch" href="/media/background_home_01.jpg"/>
		<link rel="prefetch" href="/media/background_home_02.jpg"/>
		<link rel="prefetch" href="/media/background_home_03.jpg"/>
		<link rel="prefetch" href="/media/background_home_04.jpg"/>
		<link rel="prefetch" href="/media/background_home_05.jpg"/>
	</head>
	<body class="bg_fixed center_column" id="background" style="background-image: url('/media/background_home_01.jpg');">
		<link rel="stylesheet" href="/css/style_main.css">
		<script type="text/javascript">
			selectRandomBackground("background", [
				"/media/background_home_01.jpg",
				"/media/background_home_02.jpg",
				"/media/background_home_03.jpg",
				"/media/background_home_04.jpg",
				"/media/background_home_05.jpg"
			]);
			
			getTCUNetInfo(function(tcuNetInfo) {
				createTopNavbar(tcuNetInfo, true);
			});
		</script>
		
		<!-- Container for rows (horizontal) -->
		<div class="center_column">
			<div class="page_content" id="page_content" style="width: 100%; margin-top: 48px;">
				<!-- Latest News -->
				<h1 id="page_title" class="page_header_text anim_fade_in">News</h1>
				<!-- <p id="page_subtitle" class="page_header_text anim_fade_in" style="font-size: 32px;">Latest TCU News</p> -->
				<div id="news_list_container">
					<script type="text/javascript">
						let indexOfPost = document.URL.indexOf(NEWS_POST_REF);
						let postId = null;
						if (indexOfPost != -1) {
							postId = document.URL.substring(indexOfPost + NEWS_POST_REF.length);
						}
						
						let tempLoadingLabel = document.createElement("h1");
						tempLoadingLabel.id = "loading_label";
						tempLoadingLabel.className = "page_header_text";
						tempLoadingLabel.style = "font-size: 64px; text-align: center; margin-bottom: 500px;";
						tempLoadingLabel.innerText = postId != null ? "LOADING POST..." : "GETTING LATEST NEWS...";
						document.getElementById("page_content").appendChild(tempLoadingLabel);
						
						getTCUNetInfo(function(tcuNetInfo) {
							if (tcuNetInfo != null) {
								// Check if the url ends with "?post=...", if so then show a specific post, otherwise show all news.
								let showingPost = false;
								if (postId != null) {
									fullPathToPost = getNewsPostPath(tcuNetInfo, postId);
									if (fullPathToPost != null) {
										getJsonFromURL(fullPathToPost, function(post) {
											if (post != null) {
												post.File = fullPathToPost;
												
												let returnBackLink = document.createElement("a");
												returnBackLink.id = "return_back";
												returnBackLink.style = "margin-top: 64px; margin-bottom: 64px; font-size: 32px;";
												returnBackLink.innerText = "\n< Back";
												returnBackLink.href = "/news/";
												document.getElementById("news_list_container").appendChild(returnBackLink);
												
												let postContainer = createPostFrame(post, NEWS_POST_REF + postId,"news_list_container",
														{ "style": "" }, null,
														null, null
												);
												postContainer.id = "target_post";
												document.head.getElementsByTagName("title")[0].innerText = "TCU | " + post.Title;
												tempLoadingLabel.remove();
												document.getElementById("page_title").remove();
											} else {
												// Failed to load
												location.href = "/news/";
											}
										});
										showingPost = true;
									}
								}
								if (!showingPost) {
									// No specific post selected or found, just show all news //
									document.getElementById("news_list_container").className += " anim_slide_from_below";	// Add animation to newslist only
									getTCUNewsList(tcuNetInfo, function(newslist) {
										if (newslist.length > 0) {
											for (let i = 0; i < newslist.length; i++) {
												// Because we want to sort by latest to oldest
												let newsFile = newslist[newslist.length - 1 - i];
												if (newsFile.endsWith(".json")) {
													getJsonFromURL(newsFile, function(post) {
														if (post != null) {
															post.File = newsFile;
															createPostFrame(post, NEWS_POST_REF + getFile(newsFile, true), "news_list_container",
																	{ "style": "margin-bottom: 32px;" }, null,
																	null, 5
															);
														}
													});
												}
											}
											tempLoadingLabel.remove();
										} else {
											console.log("Failed to retrieve any news!");
										}
									});
								}
							} else {
								tempLoadingLabel.innerText = "Something went wrnog. Please try again later!";
							}
						});
					</script>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			createLegalWarningBox();
		</script>
	</body>
</html>